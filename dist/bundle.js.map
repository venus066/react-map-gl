{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///bundle.js","webpack:///webpack/bootstrap 7fa5850c894d9607d5f1","webpack:///external \"immutable\"","webpack:///./src/index.js","webpack:///./src/components/MapGL.js","webpack:///external \"mapbox-gl\"","webpack:///external \"react\"","webpack:///./src/utils/diff-styles.js","webpack:///./src/utils/style-utils.js"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_0__","__WEBPACK_EXTERNAL_MODULE_3__","__WEBPACK_EXTERNAL_MODULE_4__","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_interopRequireDefault","obj","default","value","_MapGL","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","writable","setPrototypeOf","__proto__","noop","_createClass","defineProperties","target","props","length","descriptor","key","protoProps","staticProps","_mapboxGl","_mapboxGl2","_immutable","_react","_diffStyles2","_diffStyles3","_styleUtils","_styleUtils2","MapGL","_PureComponent","_this","getPrototypeOf","_queryParams","accessToken","supported","componentDidMount","componentWillReceiveProps","componentDidUpdate","_onClick","bind","_onViewportChange","mapStyle","Map","isMap","toJS","map","container","_container","style","center","longitude","latitude","zoom","pitch","bearing","interactive","onViewportChange","attributionControl","preserveDrawingBuffer","canvas","getCanvas","outline","onLoad","once","on","_map","_updateMapViewport","_updateQueryParams","newProps","_updateMapStyle","remove","geometry","parameters","queryParams","layers","queryRenderedFeatures","interactiveLayerIds","update","newSource","source","type","oldSource","getSource","id","oldOpts","workerOptions","undefined","maxzoom","geojsonVtOptions","maxZoom","buffer","tolerance","cluster","clusterRadius","superclusterOptions","radius","clusterMaxZoom","setData","data","removeSource","addSource","prevStyle","nextStyle","styleKeysMap","delete","_this2","prevKeysMap","nextKeysMap","prevKeysList","keys","nextKeysList","some","setStyle","_diffStyles","sourcesDiff","layersDiff","updates","node","layer","enter","forEach","_updateSource","exit","exiting","getLayer","removeLayer","addLayer","before","oldProps","oldMapStyle","preventStyleDiffing","_setDiffStyle","getCenter","lat","lng","getZoom","getPitch","getBearing","flyTo","event","_map$getCenter","viewport","position","bbox","onClick","point","x","y","features","_getFeatures","clickRadius","_this3","_props","className","createElement","ref","_ref","PureComponent","displayName","defaultProps","diffSources","prevSources","nextSources","prevIds","keySeq","toArray","nextIds","nextSource","equals","push","diffLayers","prevLayers","nextLayers","prevMap","nextMap","index","layerImBehind","reverse","diffStyle","getInteractiveLayerIds","filter"],"mappings":"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","file":"bundle.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"immutable\"), require(\"mapbox-gl\"), require(\"react\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"immutable\", \"mapbox-gl\", \"react\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@urbica/react-map-gl\"] = factory(require(\"immutable\"), require(\"mapbox-gl\"), require(\"react\"));\n\telse\n\t\troot[\"@urbica/react-map-gl\"] = factory(root[\"immutable\"], root[\"mapbox-gl\"], root[\"react\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_4__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"immutable\"), require(\"mapbox-gl\"), require(\"react\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"immutable\", \"mapbox-gl\", \"react\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@urbica/react-map-gl\"] = factory(require(\"immutable\"), require(\"mapbox-gl\"), require(\"react\"));\n\telse\n\t\troot[\"@urbica/react-map-gl\"] = factory(root[\"immutable\"], root[\"mapbox-gl\"], root[\"react\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_4__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 1);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _MapGL = __webpack_require__(2);\n\nObject.defineProperty(exports, 'default', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_MapGL).default;\n  }\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _mapboxGl = __webpack_require__(3);\n\nvar _mapboxGl2 = _interopRequireDefault(_mapboxGl);\n\nvar _immutable = __webpack_require__(0);\n\nvar _react = __webpack_require__(4);\n\nvar _diffStyles2 = __webpack_require__(5);\n\nvar _diffStyles3 = _interopRequireDefault(_diffStyles2);\n\nvar _styleUtils = __webpack_require__(6);\n\nvar _styleUtils2 = _interopRequireDefault(_styleUtils);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction noop() {}\n\n/**\n * Properties\n */\n\nvar MapGL = function (_PureComponent) {\n  _inherits(MapGL, _PureComponent);\n\n  _createClass(MapGL, null, [{\n    key: 'supported',\n    value: function supported() {\n      return _mapboxGl2.default && _mapboxGl2.default.supported();\n    }\n  }]);\n\n  function MapGL(props) {\n    _classCallCheck(this, MapGL);\n\n    var _this = _possibleConstructorReturn(this, (MapGL.__proto__ || Object.getPrototypeOf(MapGL)).call(this, props));\n\n    _this._queryParams = {};\n\n    if (_mapboxGl2.default) {\n      _mapboxGl2.default.accessToken = props.accessToken;\n    }\n\n    if (!MapGL.supported()) {\n      _this.componentDidMount = noop;\n      _this.componentWillReceiveProps = noop;\n      _this.componentDidUpdate = noop;\n    }\n\n    _this._onClick = _this._onClick.bind(_this);\n    _this._onViewportChange = _this._onViewportChange.bind(_this);\n    return _this;\n  }\n\n  _createClass(MapGL, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      if (!_mapboxGl2.default) {\n        return;\n      }\n\n      var mapStyle = _immutable.Map.isMap(this.props.mapStyle) ? this.props.mapStyle.toJS() : this.props.mapStyle;\n\n      var map = new _mapboxGl2.default.Map({\n        container: this._container,\n        style: mapStyle,\n        center: [this.props.longitude, this.props.latitude],\n        zoom: this.props.zoom,\n        pitch: this.props.pitch,\n        bearing: this.props.bearing,\n        interactive: !!this.props.onViewportChange,\n        attributionControl: this.props.attributionControl,\n        preserveDrawingBuffer: this.props.preserveDrawingBuffer\n      });\n\n      // Disable outline style\n      var canvas = map.getCanvas();\n      if (canvas) {\n        canvas.style.outline = 'none';\n      }\n\n      // Attach optional onLoad function\n      if (this.props.onLoad) {\n        map.once('load', this.props.onLoad);\n      }\n\n      map.on('click', this._onClick);\n      map.on('dragend', this._onViewportChange);\n      map.on('zoomend', this._onViewportChange);\n\n      this._map = map;\n      this._updateMapViewport(this.props);\n      this._updateQueryParams(this.props.mapStyle);\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(newProps) {\n      if (!_mapboxGl2.default) {\n        return;\n      }\n\n      this._updateMapViewport(newProps);\n      this._updateMapStyle(this.props, newProps);\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      if (!_mapboxGl2.default) {\n        return;\n      }\n\n      if (this._map) {\n        this._map.remove();\n      }\n    }\n\n    /**\n     * Exposes Mapbox GL Map instance.\n     * External apps can access map this way\n     *\n     * @returns {mapboxgl.Map}\n     */\n\n  }, {\n    key: 'getMap',\n    value: function getMap() {\n      return this._map;\n    }\n\n    /** Uses Mapbox's\n      * queryRenderedFeatures API to find features at point or in a bounding box.\n      * https://www.mapbox.com/mapbox-gl-js/api/#Map#queryRenderedFeatures\n      * To query only some of the layers, set the `interactive` property in the\n      * layer style to `true`.\n      * @param {[Number, Number]|[[Number, Number], [Number, Number]]} geometry -\n      *   Point or an array of two points defining the bounding box\n      * @param {Object} parameters - query options\n      */\n\n  }, {\n    key: 'queryRenderedFeatures',\n    value: function queryRenderedFeatures(geometry, parameters) {\n      var queryParams = parameters || this._queryParams;\n      if (queryParams.layers && queryParams.layers.length === 0) {\n        return [];\n      }\n      return this._map.queryRenderedFeatures(geometry, queryParams);\n    }\n\n    /**\n     * Hover and click only query layers whose interactive property is true\n     *\n     * @private\n     * @param {MapStyle} mapStyle\n     */\n\n  }, {\n    key: '_updateQueryParams',\n    value: function _updateQueryParams(mapStyle) {\n      var interactiveLayerIds = (0, _styleUtils2.default)(mapStyle);\n      this._queryParams = { layers: interactiveLayerIds };\n    }\n\n    /**\n     * Update a source in the map style\n     *\n     * @private\n     * @param {SourcesDiffElement} update\n     */\n\n  }, {\n    key: '_updateSource',\n    value: function _updateSource(update) {\n      var map = this._map;\n      var newSource = update.source.toJS();\n      if (newSource.type === 'geojson') {\n        var oldSource = map.getSource(update.id);\n        if (oldSource.type === 'geojson') {\n          // update data if no other GeoJSONSource options were changed\n          var oldOpts = oldSource.workerOptions;\n          if ((newSource.maxzoom === undefined || newSource.maxzoom === oldOpts.geojsonVtOptions.maxZoom) && (newSource.buffer === undefined || newSource.buffer === oldOpts.geojsonVtOptions.buffer) && (newSource.tolerance === undefined || newSource.tolerance === oldOpts.geojsonVtOptions.tolerance) && (newSource.cluster === undefined || newSource.cluster === oldOpts.cluster) && (newSource.clusterRadius === undefined || newSource.clusterRadius === oldOpts.superclusterOptions.radius) && (newSource.clusterMaxZoom === undefined || newSource.clusterMaxZoom === oldOpts.superclusterOptions.maxZoom)) {\n            oldSource.setData(newSource.data);\n            return;\n          }\n        }\n      }\n\n      map.removeSource(update.id);\n      map.addSource(update.id, newSource);\n    }\n\n    /**\n     * Individually update the maps source and layers that have changed if all\n     * other style props haven't changed. This prevents flicking of the map when\n     * styles only change sources or layers.\n     *\n     * @private\n     * @param {MapStyle} prevStyle\n     * @param {MapStyle} nextStyle\n     * @returns {void}\n     */\n\n  }, {\n    key: '_setDiffStyle',\n    value: function _setDiffStyle(prevStyle, nextStyle) {\n      var _this2 = this;\n\n      function styleKeysMap(style) {\n        return style.map(function () {\n          return true;\n        }).delete('layers').delete('sources').toJS();\n      }\n\n      var prevKeysMap = prevStyle && (styleKeysMap(prevStyle) || {});\n      var nextKeysMap = styleKeysMap(nextStyle);\n\n      function propsOtherThanLayersOrSourcesDiffer() {\n        var prevKeysList = Object.keys(prevKeysMap);\n        var nextKeysList = Object.keys(nextKeysMap);\n        if (prevKeysList.length !== nextKeysList.length) {\n          return true;\n        }\n        // `nextStyle` and `prevStyle` should not have the same set of props.\n        if (nextKeysList.some(function (key) {\n          return prevStyle.get(key) !== nextStyle.get(key);\n        }\n        // But the value of one of those props is different.\n        )) {\n          return true;\n        }\n        return false;\n      }\n\n      var map = this._map;\n\n      if (!prevStyle || propsOtherThanLayersOrSourcesDiffer()) {\n        map.setStyle(nextStyle.toJS());\n        return;\n      }\n\n      var _diffStyles = (0, _diffStyles3.default)(prevStyle, nextStyle),\n          sourcesDiff = _diffStyles.sourcesDiff,\n          layersDiff = _diffStyles.layersDiff;\n\n      // TODO: It's rather difficult to determine style diffing in the presence\n      // of refs. For now, if any style update has a ref, fallback to no diffing.\n      // We can come back to this case if there's a solid usecase.\n\n\n      if (layersDiff.updates.some(function (node) {\n        return node.layer.get('ref');\n      })) {\n        map.setStyle(nextStyle.toJS());\n        return;\n      }\n\n      sourcesDiff.enter.forEach(function (enter) {\n        return map.addSource(enter.id, enter.source.toJS());\n      });\n\n      sourcesDiff.update.forEach(function (update) {\n        return _this2._updateSource(update);\n      });\n\n      sourcesDiff.exit.forEach(function (exit) {\n        return map.removeSource(exit.id);\n      });\n\n      layersDiff.exiting.forEach(function (exit) {\n        if (map.style.getLayer(exit.id)) {\n          map.removeLayer(exit.id);\n        }\n      });\n\n      layersDiff.updates.forEach(function (update) {\n        if (!update.enter) {\n          // This is an old layer that needs to be updated. Remove the old layer\n          // with the same id and add it back again.\n          map.removeLayer(update.id);\n        }\n        map.addLayer(update.layer.toJS(), update.before);\n      });\n    }\n\n    /**\n     * Update Map style from newProps\n     *\n     * @private\n     * @param {Props} oldProps\n     * @param {Props} newProps\n     */\n\n  }, {\n    key: '_updateMapStyle',\n    value: function _updateMapStyle(oldProps, newProps) {\n      var mapStyle = newProps.mapStyle;\n      var oldMapStyle = oldProps.mapStyle;\n      if (mapStyle !== oldMapStyle) {\n        if (_immutable.Map.isMap(mapStyle)) {\n          if (this.props.preventStyleDiffing) {\n            this._map.setStyle(mapStyle.toJS());\n          } else {\n            this._setDiffStyle(oldMapStyle, mapStyle);\n          }\n        } else {\n          this._map.setStyle(mapStyle);\n        }\n        this._updateQueryParams(mapStyle);\n      }\n    }\n\n    /**\n     * Update Map viewport from newProps\n     *\n     * @private\n     * @param {Props} newProps\n     */\n\n  }, {\n    key: '_updateMapViewport',\n    value: function _updateMapViewport(newProps) {\n      var map = this._map;\n      var center = map.getCenter();\n\n      var viewportChanged = newProps.latitude !== center.lat || newProps.longitude !== center.lng || newProps.zoom !== map.getZoom() || newProps.pitch !== map.getPitch() || newProps.bearing !== map.getBearing();\n\n      if (viewportChanged) {\n        map.flyTo({\n          center: [newProps.longitude, newProps.latitude],\n          zoom: newProps.zoom,\n          pitch: newProps.pitch,\n          bearing: newProps.bearing\n        });\n      }\n    }\n\n    /**\n     * fires `onViewportChange` callback when the user interacted with the map.\n     *\n     * @private\n     * @param {(mapboxgl.MapMouseEvent | mapboxgl.MapTouchEvent)} event\n     */\n\n  }, {\n    key: '_onViewportChange',\n    value: function _onViewportChange(event) {\n      var map = event.target;\n\n      var _map$getCenter = map.getCenter(),\n          lng = _map$getCenter.lng,\n          lat = _map$getCenter.lat;\n\n      var zoom = map.getZoom();\n      var pitch = map.getPitch();\n      var bearing = map.getBearing();\n\n      var viewport = {\n        latitude: lat,\n        longitude: lng,\n        zoom: zoom,\n        pitch: pitch,\n        bearing: bearing\n      };\n\n      this.props.onViewportChange(viewport);\n    }\n  }, {\n    key: '_getFeatures',\n    value: function _getFeatures(position, radius) {\n      // Radius enables point features, like marker symbols, to be clicked.\n      if (radius) {\n        var bbox = [[position[0] - radius, position[1] - radius], [position[0] + radius, position[1] + radius]];\n\n        return this._map.queryRenderedFeatures(bbox, this._queryParams);\n      }\n\n      return this._map.queryRenderedFeatures(position, this._queryParams);\n    }\n  }, {\n    key: '_onClick',\n    value: function _onClick(event) {\n      if (this.props.onClick) {\n        var position = [event.point.x, event.point.y];\n\n        /* eslint-disable no-param-reassign */\n        event.features = this._getFeatures(position, this.props.clickRadius);\n\n        this.props.onClick(event);\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this3 = this;\n\n      var _props = this.props,\n          className = _props.className,\n          style = _props.style;\n\n\n      return (0, _react.createElement)('div', {\n        ref: function ref(_ref) {\n          return _this3._container = _ref;\n        },\n        style: style,\n        className: className\n      });\n    }\n  }]);\n\n  return MapGL;\n}(_react.PureComponent);\n\nMapGL.displayName = 'MapGL';\nMapGL.defaultProps = {\n  className: null,\n  mapStyle: 'mapbox://styles/mapbox/light-v8',\n  accessToken: null,\n  preserveDrawingBuffer: false,\n  onViewportChange: null,\n  onClick: null,\n  clickRadius: 0,\n  attributionControl: true,\n  preventStyleDiffing: false,\n  bearing: 0,\n  pitch: 0,\n  onLoad: null\n};\n\nexports.default = MapGL;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_3__;\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_4__;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.diffSources = diffSources;\nexports.diffLayers = diffLayers;\nexports.default = diffStyle;\nfunction diffSources(prevStyle, nextStyle) {\n  var prevSources = prevStyle.get('sources');\n  var nextSources = nextStyle.get('sources');\n  var enter = [];\n  var update = [];\n  var exit = [];\n  var prevIds = prevSources.keySeq().toArray();\n  var nextIds = nextSources.keySeq().toArray();\n  prevIds.forEach(function (id) {\n    var nextSource = nextSources.get(id);\n    if (nextSource) {\n      if (!nextSource.equals(prevSources.get(id))) {\n        update.push({ id: id, source: nextSources.get(id) });\n      }\n    } else {\n      exit.push({ id: id, source: prevSources.get(id) });\n    }\n  });\n  nextIds.forEach(function (id) {\n    var prevSource = prevSources.get(id);\n    if (!prevSource) {\n      enter.push({ id: id, source: nextSources.get(id) });\n    }\n  });\n  return { enter: enter, update: update, exit: exit };\n}\n\n// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nfunction diffLayers(prevStyle, nextStyle) {\n  var prevLayers = prevStyle.get('layers');\n  var nextLayers = nextStyle.get('layers');\n  var updates = [];\n  var exiting = [];\n  var prevMap = {};\n  var nextMap = {};\n  nextLayers.forEach(function (layer, index) {\n    var id = layer.get('id');\n    var layerImBehind = nextLayers.get(index + 1);\n    nextMap[id] = {\n      layer: layer,\n      id: id,\n      // The `id` of the layer before this one.\n      before: layerImBehind ? layerImBehind.get('id') : null,\n      enter: true\n    };\n  });\n  prevLayers.forEach(function (layer, index) {\n    var id = layer.get('id');\n    var layerImBehind = prevLayers.get(index + 1);\n    prevMap[id] = {\n      layer: layer,\n      id: id,\n      before: layerImBehind ? layerImBehind.get('id') : null\n    };\n    if (nextMap[id]) {\n      // Not a new layer.\n      nextMap[id].enter = false;\n    } else {\n      // This layer is being removed.\n      exiting.push(prevMap[id]);\n    }\n  });\n  nextLayers.reverse().forEach(function (layer) {\n    var id = layer.get('id');\n    if (!prevMap[id] || !prevMap[id].layer.equals(nextMap[id].layer) || prevMap[id].before !== nextMap[id].before) {\n      // This layer is being changed.\n      updates.push(nextMap[id]);\n    }\n  });\n  return { updates: updates, exiting: exiting };\n}\n\nfunction diffStyle(prevStyle, nextStyle) {\n  return {\n    sourcesDiff: diffSources(prevStyle, nextStyle),\n    layersDiff: diffLayers(prevStyle, nextStyle)\n  };\n}\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _immutable = __webpack_require__(0);\n\nfunction getInteractiveLayerIds(mapStyle) {\n  if (_immutable.Map.isMap(mapStyle)) {\n    var layers = mapStyle.get('layers');\n    if (layers) {\n      return layers.filter(function (l) {\n        return l.get('interactive');\n      }).map(function (l) {\n        return l.get('id');\n      }).toJS();\n    }\n  }\n\n  return [];\n}\n\nexports.default = getInteractiveLayerIds;\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// bundle.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7fa5850c894d9607d5f1","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"immutable\"\n// module id = 0\n// module chunks = 0","export { default } from './components/MapGL';\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","/* @flow */\n\nimport mapboxgl from 'mapbox-gl';\nimport { Map } from 'immutable';\nimport { PureComponent, createElement } from 'react';\n\nimport diffStyles from '../utils/diff-styles';\nimport getInteractiveLayerIds from '../utils/style-utils';\n\nimport type { MapStyle, SourcesDiffElement, Viewport } from '../types';\n\nfunction noop() {}\n\n/**\n * Properties\n */\ntype Props = {\n  /** container className */\n  className: string,\n\n  /** container style */\n  style: Object,\n\n  /** Mapbox API access token for mapbox-gl-js. Required when using Mapbox vector tiles/styles. */\n  accessToken: string,\n\n  /** Mapbox WebGL context creation option. Useful when you want to export the canvas as a PNG. */\n  preserveDrawingBuffer: boolean,\n\n  /** Show attribution control or not. */\n  attributionControl: boolean,\n\n  /** The Mapbox style. A string url or a MapboxGL style Immutable.Map object. */\n  mapStyle: MapStyle,\n\n  /** There are known issues with style diffing. As stopgap, add option to prevent style diffing. */\n  preventStyleDiffing: boolean,\n\n  /**\n   * `onViewportChange` callback is fired when the user interacted with the\n   * map. The object passed to the callback contains viewport properties\n   * such as `longitude`, `latitude`, `zoom` etc.\n   */\n  onViewportChange: (viewport: Viewport) => mixed,\n\n  /**\n    * Called when the map is clicked.\n    * @callback\n    * @param {Object} event - The mouse event.\n    * @param {[Number, Number]} event.lngLat - The coordinates of the pointer\n    * @param {Array} event.features - The features under the pointer, using Mapbox's\n    * queryRenderedFeatures API:\n    * https://www.mapbox.com/mapbox-gl-js/api/#Map#queryRenderedFeatures\n    * To make a layer interactive, set the `interactive` property in the\n    * layer style to `true`. See Mapbox's style spec\n    * https://www.mapbox.com/mapbox-gl-style-spec/#layer-interactive\n    */\n  onClick: (event: mapboxgl.MapEvent) => mixed,\n\n  /** Radius to detect features around a clicked point. Defaults to 0. */\n  clickRadius: number,\n\n  /** The longitude of the center of the map. */\n  longitude: number,\n\n  /** The latitude of the center of the map. */\n  latitude: number,\n\n  /** The tile zoom level of the map. */\n  zoom: number,\n\n  /** Specify the bearing of the viewport */\n  bearing: number,\n\n  /** Specify the pitch of the viewport */\n  pitch: number,\n\n  /** The onLoad callback for the map */\n  onLoad: Function\n};\n\nclass MapGL extends PureComponent<Props, *> {\n  props: Props;\n\n  componentDidMount: Function;\n  componentWillReceiveProps: Function;\n  componentDidUpdate: Function;\n\n  _map: mapboxgl.Map;\n  _container: HTMLElement;\n  _queryParams: Object;\n  _onViewportChange: (event: mapboxgl.MapMouseEvent | mapboxgl.MapTouchEvent) => void;\n\n  static supported() {\n    return mapboxgl && mapboxgl.supported();\n  }\n\n  constructor(props: Props) {\n    super(props);\n    this._queryParams = {};\n\n    if (mapboxgl) {\n      mapboxgl.accessToken = props.accessToken;\n    }\n\n    if (!MapGL.supported()) {\n      this.componentDidMount = noop;\n      this.componentWillReceiveProps = noop;\n      this.componentDidUpdate = noop;\n    }\n\n    this._onClick = this._onClick.bind(this);\n    this._onViewportChange = this._onViewportChange.bind(this);\n  }\n\n  componentDidMount() {\n    if (!mapboxgl) {\n      return;\n    }\n\n    const mapStyle = Map.isMap(this.props.mapStyle)\n      ? this.props.mapStyle.toJS()\n      : this.props.mapStyle;\n\n    const map = new mapboxgl.Map({\n      container: this._container,\n      style: mapStyle,\n      center: [this.props.longitude, this.props.latitude],\n      zoom: this.props.zoom,\n      pitch: this.props.pitch,\n      bearing: this.props.bearing,\n      interactive: !!this.props.onViewportChange,\n      attributionControl: this.props.attributionControl,\n      preserveDrawingBuffer: this.props.preserveDrawingBuffer\n    });\n\n    // Disable outline style\n    const canvas = map.getCanvas();\n    if (canvas) {\n      canvas.style.outline = 'none';\n    }\n\n    // Attach optional onLoad function\n    if (this.props.onLoad) {\n      map.once('load', this.props.onLoad);\n    }\n\n    map.on('click', this._onClick);\n    map.on('dragend', this._onViewportChange);\n    map.on('zoomend', this._onViewportChange);\n\n    this._map = map;\n    this._updateMapViewport(this.props);\n    this._updateQueryParams(this.props.mapStyle);\n  }\n\n  componentWillReceiveProps(newProps: Props) {\n    if (!mapboxgl) {\n      return;\n    }\n\n    this._updateMapViewport(newProps);\n    this._updateMapStyle(this.props, newProps);\n  }\n\n  componentWillUnmount() {\n    if (!mapboxgl) {\n      return;\n    }\n\n    if (this._map) {\n      this._map.remove();\n    }\n  }\n\n  /**\n   * Exposes Mapbox GL Map instance.\n   * External apps can access map this way\n   *\n   * @returns {mapboxgl.Map}\n   */\n  getMap(): mapboxgl.Map {\n    return this._map;\n  }\n\n  /** Uses Mapbox's\n    * queryRenderedFeatures API to find features at point or in a bounding box.\n    * https://www.mapbox.com/mapbox-gl-js/api/#Map#queryRenderedFeatures\n    * To query only some of the layers, set the `interactive` property in the\n    * layer style to `true`.\n    * @param {[Number, Number]|[[Number, Number], [Number, Number]]} geometry -\n    *   Point or an array of two points defining the bounding box\n    * @param {Object} parameters - query options\n    */\n  queryRenderedFeatures(geometry: mapboxgl.Point | mapboxgl.Point[], parameters: Object) {\n    const queryParams = parameters || this._queryParams;\n    if (queryParams.layers && queryParams.layers.length === 0) {\n      return [];\n    }\n    return this._map.queryRenderedFeatures(geometry, queryParams);\n  }\n\n  /**\n   * Hover and click only query layers whose interactive property is true\n   *\n   * @private\n   * @param {MapStyle} mapStyle\n   */\n  _updateQueryParams(mapStyle: MapStyle): void {\n    const interactiveLayerIds = getInteractiveLayerIds(mapStyle);\n    this._queryParams = { layers: interactiveLayerIds };\n  }\n\n  /**\n   * Update a source in the map style\n   *\n   * @private\n   * @param {SourcesDiffElement} update\n   */\n  _updateSource(update: SourcesDiffElement): void {\n    const map = this._map;\n    const newSource = update.source.toJS();\n    if (newSource.type === 'geojson') {\n      const oldSource = map.getSource(update.id);\n      if (oldSource.type === 'geojson') {\n        // update data if no other GeoJSONSource options were changed\n        const oldOpts = oldSource.workerOptions;\n        if (\n          (newSource.maxzoom === undefined ||\n            newSource.maxzoom === oldOpts.geojsonVtOptions.maxZoom) &&\n          (newSource.buffer === undefined ||\n            newSource.buffer === oldOpts.geojsonVtOptions.buffer) &&\n          (newSource.tolerance === undefined ||\n            newSource.tolerance === oldOpts.geojsonVtOptions.tolerance) &&\n          (newSource.cluster === undefined ||\n            newSource.cluster === oldOpts.cluster) &&\n          (newSource.clusterRadius === undefined ||\n            newSource.clusterRadius === oldOpts.superclusterOptions.radius) &&\n          (newSource.clusterMaxZoom === undefined ||\n            newSource.clusterMaxZoom === oldOpts.superclusterOptions.maxZoom)\n        ) {\n          oldSource.setData(newSource.data);\n          return;\n        }\n      }\n    }\n\n    map.removeSource(update.id);\n    map.addSource(update.id, newSource);\n  }\n\n  /**\n   * Individually update the maps source and layers that have changed if all\n   * other style props haven't changed. This prevents flicking of the map when\n   * styles only change sources or layers.\n   *\n   * @private\n   * @param {MapStyle} prevStyle\n   * @param {MapStyle} nextStyle\n   * @returns {void}\n   */\n  _setDiffStyle(prevStyle: MapStyle, nextStyle: MapStyle): void {\n    function styleKeysMap(style: MapStyle) {\n      return style.map(() => true).delete('layers').delete('sources').toJS();\n    }\n\n    const prevKeysMap = prevStyle && (styleKeysMap(prevStyle) || {});\n    const nextKeysMap = styleKeysMap(nextStyle);\n\n    function propsOtherThanLayersOrSourcesDiffer() {\n      const prevKeysList = Object.keys(prevKeysMap);\n      const nextKeysList = Object.keys(nextKeysMap);\n      if (prevKeysList.length !== nextKeysList.length) {\n        return true;\n      }\n      // `nextStyle` and `prevStyle` should not have the same set of props.\n      if (\n        nextKeysList.some(\n          key => prevStyle.get(key) !== nextStyle.get(key)\n          // But the value of one of those props is different.\n        )\n      ) {\n        return true;\n      }\n      return false;\n    }\n\n    const map = this._map;\n\n    if (!prevStyle || propsOtherThanLayersOrSourcesDiffer()) {\n      map.setStyle(nextStyle.toJS());\n      return;\n    }\n\n    const { sourcesDiff, layersDiff } = diffStyles(prevStyle, nextStyle);\n\n    // TODO: It's rather difficult to determine style diffing in the presence\n    // of refs. For now, if any style update has a ref, fallback to no diffing.\n    // We can come back to this case if there's a solid usecase.\n    if (layersDiff.updates.some(node => node.layer.get('ref'))) {\n      map.setStyle(nextStyle.toJS());\n      return;\n    }\n\n    sourcesDiff.enter.forEach(enter =>\n      map.addSource(enter.id, enter.source.toJS())\n    );\n\n    sourcesDiff.update.forEach(update => this._updateSource(update));\n\n    sourcesDiff.exit.forEach(exit => map.removeSource(exit.id));\n\n    layersDiff.exiting.forEach((exit) => {\n      if (map.style.getLayer(exit.id)) {\n        map.removeLayer(exit.id);\n      }\n    });\n\n    layersDiff.updates.forEach((update) => {\n      if (!update.enter) {\n        // This is an old layer that needs to be updated. Remove the old layer\n        // with the same id and add it back again.\n        map.removeLayer(update.id);\n      }\n      map.addLayer(update.layer.toJS(), update.before);\n    });\n  }\n\n  /**\n   * Update Map style from newProps\n   *\n   * @private\n   * @param {Props} oldProps\n   * @param {Props} newProps\n   */\n  _updateMapStyle(oldProps: Props, newProps: Props): void {\n    const mapStyle = newProps.mapStyle;\n    const oldMapStyle = oldProps.mapStyle;\n    if (mapStyle !== oldMapStyle) {\n      if (Map.isMap(mapStyle)) {\n        if (this.props.preventStyleDiffing) {\n          this._map.setStyle(mapStyle.toJS());\n        } else {\n          this._setDiffStyle(oldMapStyle, mapStyle);\n        }\n      } else {\n        this._map.setStyle(mapStyle);\n      }\n      this._updateQueryParams(mapStyle);\n    }\n  }\n\n  /**\n   * Update Map viewport from newProps\n   *\n   * @private\n   * @param {Props} newProps\n   */\n  _updateMapViewport(newProps: Props): void {\n    const map = this._map;\n    const center = map.getCenter();\n\n    const viewportChanged =\n      newProps.latitude !== center.lat ||\n      newProps.longitude !== center.lng ||\n      newProps.zoom !== map.getZoom() ||\n      newProps.pitch !== map.getPitch() ||\n      newProps.bearing !== map.getBearing();\n\n    if (viewportChanged) {\n      map.flyTo({\n        center: [newProps.longitude, newProps.latitude],\n        zoom: newProps.zoom,\n        pitch: newProps.pitch,\n        bearing: newProps.bearing\n      });\n    }\n  }\n\n  /**\n   * fires `onViewportChange` callback when the user interacted with the map.\n   *\n   * @private\n   * @param {(mapboxgl.MapMouseEvent | mapboxgl.MapTouchEvent)} event\n   */\n  _onViewportChange(event: mapboxgl.MapMouseEvent | mapboxgl.MapTouchEvent): void {\n    const map = event.target;\n    const { lng, lat } = map.getCenter();\n    const zoom = map.getZoom();\n    const pitch = map.getPitch();\n    const bearing = map.getBearing();\n\n    const viewport = {\n      latitude: lat,\n      longitude: lng,\n      zoom,\n      pitch,\n      bearing\n    };\n\n    this.props.onViewportChange(viewport);\n  }\n\n  _getFeatures(position: [number, number], radius: number) {\n    // Radius enables point features, like marker symbols, to be clicked.\n    if (radius) {\n      const bbox = [\n        [position[0] - radius, position[1] - radius],\n        [position[0] + radius, position[1] + radius]\n      ];\n\n      return this._map.queryRenderedFeatures(bbox, this._queryParams);\n    }\n\n    return this._map.queryRenderedFeatures(position, this._queryParams);\n  }\n\n  _onClick(event: mapboxgl.MapEvent): void {\n    if (this.props.onClick) {\n      const position = [event.point.x, event.point.y];\n\n      /* eslint-disable no-param-reassign */\n      event.features = this._getFeatures(position, this.props.clickRadius);\n\n      this.props.onClick(event);\n    }\n  }\n\n  render() {\n    const { className, style } = this.props;\n\n    return createElement('div', {\n      ref: ref => this._container = ref,\n      style,\n      className\n    });\n  }\n}\n\nMapGL.displayName = 'MapGL';\nMapGL.defaultProps = {\n  className: null,\n  mapStyle: 'mapbox://styles/mapbox/light-v8',\n  accessToken: null,\n  preserveDrawingBuffer: false,\n  onViewportChange: null,\n  onClick: null,\n  clickRadius: 0,\n  attributionControl: true,\n  preventStyleDiffing: false,\n  bearing: 0,\n  pitch: 0,\n  onLoad: null\n};\n\nexport default MapGL;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/MapGL.js","module.exports = __WEBPACK_EXTERNAL_MODULE_3__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mapbox-gl\"\n// module id = 3\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_4__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"react\"\n// module id = 4\n// module chunks = 0","/* @flow */\n\n// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport type { MapStyle, SourcesDiff, LayersDiff } from '../types';\n\nexport function diffSources(prevStyle: MapStyle, nextStyle: MapStyle): SourcesDiff {\n  const prevSources = prevStyle.get('sources');\n  const nextSources = nextStyle.get('sources');\n  const enter = [];\n  const update = [];\n  const exit = [];\n  const prevIds = prevSources.keySeq().toArray();\n  const nextIds = nextSources.keySeq().toArray();\n  prevIds.forEach((id) => {\n    const nextSource = nextSources.get(id);\n    if (nextSource) {\n      if (!nextSource.equals(prevSources.get(id))) {\n        update.push({ id, source: nextSources.get(id) });\n      }\n    } else {\n      exit.push({ id, source: prevSources.get(id) });\n    }\n  });\n  nextIds.forEach((id) => {\n    const prevSource = prevSources.get(id);\n    if (!prevSource) {\n      enter.push({ id, source: nextSources.get(id) });\n    }\n  });\n  return { enter, update, exit };\n}\n\nexport function diffLayers(prevStyle: MapStyle, nextStyle: MapStyle): LayersDiff {\n  const prevLayers = prevStyle.get('layers');\n  const nextLayers = nextStyle.get('layers');\n  const updates = [];\n  const exiting = [];\n  const prevMap = {};\n  const nextMap = {};\n  nextLayers.forEach((layer, index) => {\n    const id = layer.get('id');\n    const layerImBehind = nextLayers.get(index + 1);\n    nextMap[id] = {\n      layer,\n      id,\n      // The `id` of the layer before this one.\n      before: layerImBehind ? layerImBehind.get('id') : null,\n      enter: true\n    };\n  });\n  prevLayers.forEach((layer, index) => {\n    const id = layer.get('id');\n    const layerImBehind = prevLayers.get(index + 1);\n    prevMap[id] = {\n      layer,\n      id,\n      before: layerImBehind ? layerImBehind.get('id') : null\n    };\n    if (nextMap[id]) {\n      // Not a new layer.\n      nextMap[id].enter = false;\n    } else {\n      // This layer is being removed.\n      exiting.push(prevMap[id]);\n    }\n  });\n  nextLayers.reverse().forEach((layer) => {\n    const id = layer.get('id');\n    if (\n      !prevMap[id] ||\n      !prevMap[id].layer.equals(nextMap[id].layer) ||\n      prevMap[id].before !== nextMap[id].before\n    ) {\n      // This layer is being changed.\n      updates.push(nextMap[id]);\n    }\n  });\n  return { updates, exiting };\n}\n\nexport default function diffStyle(prevStyle: MapStyle, nextStyle: MapStyle) {\n  return {\n    sourcesDiff: diffSources(prevStyle, nextStyle),\n    layersDiff: diffLayers(prevStyle, nextStyle)\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/diff-styles.js","/* @flow */\n\nimport { Map } from 'immutable';\nimport type { MapStyle } from '../types';\n\nfunction getInteractiveLayerIds(mapStyle: MapStyle): Array<String> {\n  if (Map.isMap(mapStyle)) {\n    const layers = mapStyle.get('layers');\n    if (layers) {\n      return layers\n        .filter(l => l.get('interactive'))\n        .map(l => l.get('id'))\n        .toJS();\n    }\n  }\n\n  return [];\n}\n\nexport default getInteractiveLayerIds;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/style-utils.js"],"sourceRoot":""}